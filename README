This is a demonstration of a Netbeans Rich Client Platform (RCP)
application that shows how to embed a JRE into the installer that will
be used by the application.  The package works around numerous bugs in
the current Netbeans Installer (NBI) harness. See the JIRA issues:

https://issues.apache.org/jira/browse/NETBEANS-1157
https://issues.apache.org/jira/browse/NETBEANS-1145
https://issues.apache.org/jira/browse/NETBEANS-3332


This package enables Windows installers to work on modern versions of
Java.  The application is built using Maven and the maven-nbm-plugin,
however, the modified harness files should be usable with an ant build,
with some modification of the embedded properties.

The package includes two binary JREs, one for windows and one for
linux. It would have been nice to download and build these from the
package, but that was sufficiently complex with Maven/Ant, that it
destroyed any educational benefit. Bot files are self-extracting zips,
so if you rename them to "jre.zip" or "jre-linux.zip", you will be able
to examine their contents.

Much of this was guided by an old post of Geertjan Wielenga at
https://blogs.oracle.com/geertjan/installing-the-jre-via-an-applications-installer-via-windows
and the article at https://dzone.com/articles/including-jre-in-nbi. These
posts provide instructions on how to construct the sfx JRE files. Note
that the linux JRE is expected to have the jre under a directory called
"jre", while the windows JRE is expected the directories bin/, conf/,
lib/ and legal/ to be top level directories in the zip.


The package works around bugs in the NBI in several ways. If the
configuration variable hackEngineJar is set to "true" in the pom,
the NBI engine will be modified during the installation.  The package
includes modifications of the NBI engine classes CommonLauncher and
CreateNativeLauncherAction. These will be compiled and put in the engine
jar during the install process. CreateNativeLauncherAction supports
a property specifying information on a "compatible" Java that will be
embedded in the installer and used to validate the JRE being used.

The other trick is that the test file TestJDK is replaced in the engine
jar. This version returns a java version string that is compatible with
the one embedded in the installer, and will not be rejected by the buggy
NBI code.

In addition, the package corrects numerous textual errors in the various
ant scripts and config files in the harness. See the pom to enable/disable
these fixes.

I hope this is helpful.